#!/bin/bash

# ุณูุฑูุจุช ุฅุนุฏุงุฏ ุณุฑูุน ููุดุฑูุน StoreOman
# ุงููุณุงุฑ: /var/www/alshabibi/storeoman/

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "   ุฅุนุฏุงุฏ ูุดุฑูุน StoreOman"
echo "   ุงููุณุงุฑ: /var/www/alshabibi/storeoman/"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงููุดุฑูุน
cd /var/www/alshabibi/storeoman || exit

echo "โ ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงููุดุฑูุน..."

# ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
echo "๐ง ุงูุชุญูู ูู ุงูุตูุงุญูุงุช..."
sudo chown -R $USER:$USER /var/www/alshabibi/storeoman
sudo chmod -R 755 /var/www/alshabibi/storeoman

# ุฅูุดุงุก ููู .env ุฅุฐุง ูู ููู ููุฌูุฏุงู
if [ ! -f .env ]; then
    echo "๐ ุฅูุดุงุก ููู .env..."
    cp env.example .env
    echo "โ๏ธ  ูุฑุฌู ุชุนุฏูู ููู .env ุจุฅุนุฏุงุฏุงุช PostgreSQL ุงูุตุญูุญุฉ"
    echo "   nano .env"
else
    echo "โ ููู .env ููุฌูุฏ"
fi

# ุงูุชุญูู ูู Docker
echo "๐ณ ุงูุชุญูู ูู Docker..."
if ! command -v docker &> /dev/null; then
    echo "โ Docker ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุชู ุฃููุงู"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "โ Docker Compose ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุชู ุฃููุงู"
    exit 1
fi

echo "โ Docker ูุซุจุช"

# ุงูุชุญูู ูู postgres-docker
echo "๐ ุงูุชุญูู ูู postgres-docker..."
if docker ps | grep -q postgres; then
    echo "โ postgres-docker ูุนูู"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: postgres-docker ุบูุฑ ููุฌูุฏ ุฃู ูุง ูุนูู"
    echo "   ูุฑุฌู ุงูุชุฃูุฏ ูู ุชุดุบูู postgres-docker ุฃููุงู"
fi

# ุงูุชุญูู ูู network
echo "๐ ุงูุชุญูู ูู network..."
if docker network ls | grep -q postgres-docker; then
    echo "โ network ููุฌูุฏ"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: network postgres-docker ุบูุฑ ููุฌูุฏ"
    echo "   ูุฏ ุชุญุชุงุฌ ูุชุนุฏูู docker-compose.yml"
fi

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ ุงูุฅุนุฏุงุฏ ุงูุฃููู ููุชูู!"
echo ""
echo "ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "1. ุนุฏู ููู .env: nano .env"
echo "2. ุฃูุดุฆ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู PostgreSQL"
echo "3. ุดุบูู ุงููุดุฑูุน: docker-compose up -d --build"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
