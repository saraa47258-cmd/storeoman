version: '3.8'

# ملف docker-compose للربط مع postgres-docker الموجود
# استخدم: docker-compose -f docker-compose.postgres.yml up -d

services:
  # Nginx Web Server
  nginx:
    image: nginx:alpine
    container_name: storeoman-nginx
    ports:
      - "80:80"
    restart: unless-stopped
    volumes:
      - ./:/var/www/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php
    networks:
      - storeoman-network

  # PHP-FPM Service مع دعم PostgreSQL
  php:
    build:
      context: .
      dockerfile: Dockerfile.php
    container_name: storeoman-php
    restart: unless-stopped
    volumes:
      - ./:/var/www/html
    environment:
      - PHP_INI_SCAN_DIR=/usr/local/etc/php/conf.d
      - DB_TYPE=pgsql
      - POSTGRES_HOST=postgres_db
      - POSTGRES_DB=${POSTGRES_DB:-storeoman}
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-postgres}
      - POSTGRES_PORT=5432
    networks:
      - storeoman-network
      # ربط مع postgres-docker network
      - postgres-docker_default

networks:
  storeoman-network:
    driver: bridge
  # ربط مع network الخاص بـ postgres-docker
  postgres-docker_default:
    external: true
